<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="fr-FR">
  <head>
    <meta charset="utf-8"/>
    <meta content="text/html;charset=UTF-8" http-equiv="Content-Type"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width"/>
    <meta name="generator" content="Wintersmith"/>
    <meta name="google-site-verification" content="google36a66ae7f1a82c45"/>
    <meta name="description" content="Le blog d'Olivier"/>
    <meta name="author" content="Olivier Bazoud"/>
    <meta name="keywords" content="geek,web,java,spring,spring batch,spring batch in action,node.js,git,ruby,svn,subversion"/>
    <title>Le blog d'Olivier » Groovy aime Hudson
    </title>
    <link rel="apple-touch-icon" href="/ico/bootstrap-apple-57x57.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/ico/bootstrap-apple-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/ico/bootstrap-apple-114x114.png"/>
    <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://feeds.feedburner.com/bazoud/feed"/>
    <link rel="alternate" type="text/xml" title="RSS .92" href="http://feeds.feedburner.com/bazoud/rss"/>
    <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://feeds.feedburner.com/bazoud/atom"/>
    <link href="/vendor/bootstrap/bootstrap.min.css" rel="stylesheet"/>
    <link href="/styles/mystyle.css" rel="stylesheet"/>
    <link href="/vendor/bootstrap/prettify.css" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="/vendor/google-code-prettify/prettify.js"></script>
    <!-- Shims: IE6-8 support of HTML5 elements--><!--[if lt IE 9]>
    <script async="async" src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  </head>
  <body onload="prettyPrint()">
    <div class="navbar navbar-fixed-top"><a href="http://github.com/obazoud/blog.bazoud.com"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/camo.github.com/30f550e0d38ceb6ef5b81500c64d970b7fb0f028/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub"/></a>
      <div class="navbar-inner">
        <div class="container-fluid"><a data-toggle="collapse" data-target=".nav-collapse" class="btn btn-navbar"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a><a href="/" class="brand">Le blog d'Olivier</a>
          <div class="nav-collapse">
            <form id="search-form" action="http://www.google.com/search" method="get" class="navbar-search pull-left"><span class="glass js-search-action"><i></i></span>
              <input type="hidden" value="UTF-8" name="ie"/>
              <input type="hidden" value="UTF-8" name="oe"/>
              <input type="hidden" value="blog.bazoud.com" name="domains"/>
              <input type="hidden" value="blog.bazoud.com" name="sitesearch"/>
              <input name="q" type="text" placeholder="Rechercher avec Google..." class="search-query span3"/>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <h4>Suivez moi !</h4><a target="_blank" style="cursor: pointer;" href="http://feeds.feedburner.com/bazoud/feed"><img alt="Feed" title="Feed" src="/images/rss.png"/></a><a href="http://www.twitter.com/obazoud" style="cursor: pointer;" target="_blank"><img src="/images/twitter.png" title="Follow me on Twitter!" alt="Follow @obazoud on Twitter!"/></a><a href="https://plus.google.com/108456051643223740688" target="_blank" alt="Google +" title="Google +"><img src="/images/google-plus-48x48.png" border="0"/></a>
              <h4>Spring Batch in Action</h4><a href="http://affiliate.manning.com/idevaffiliate.php?id=1178_267_1_68" target="_blank" alt="String Batch in Action" title="String Batch in Action"><img border="0" src="/images/SpringBatchInAction.jpg" alt="String Batch in Action" title="String Batch in Action"/></a>
              <h4>Tags</h4>
              <div id="tags" class="tagcloud">
<a href="/tag/ActiveMQ" title="ActiveMQ: 2 posts" class="size-1">ActiveMQ</a>
<a href="/tag/advanced" title="advanced: 1 posts" class="size-0">advanced</a>
<a href="/tag/awk" title="awk: 3 posts" class="size-2">awk</a>
<a href="/tag/bash" title="bash: 3 posts" class="size-2">bash</a>
<a href="/tag/bdd" title="bdd: 1 posts" class="size-0">bdd</a>
<a href="/tag/blog" title="blog: 1 posts" class="size-0">blog</a>
<a href="/tag/chrome" title="chrome: 2 posts" class="size-1">chrome</a>
<a href="/tag/chromium" title="chromium: 1 posts" class="size-0">chromium</a>
<a href="/tag/chtijug" title="chtijug: 1 posts" class="size-0">chtijug</a>
<a href="/tag/cloud" title="cloud: 1 posts" class="size-0">cloud</a>
<a href="/tag/coffeescript" title="coffeescript: 1 posts" class="size-0">coffeescript</a>
<a href="/tag/commons-logging" title="commons-logging: 1 posts" class="size-0">commons-logging</a>
<a href="/tag/decode" title="decode: 1 posts" class="size-0">decode</a>
<a href="/tag/Derby" title="Derby: 1 posts" class="size-0">Derby</a>
<a href="/tag/devops" title="devops: 1 posts" class="size-0">devops</a>
<a href="/tag/docpad" title="docpad: 1 posts" class="size-0">docpad</a>
<a href="/tag/eclipse" title="eclipse: 2 posts" class="size-1">eclipse</a>
<a href="/tag/evenement" title="evenement: 4 posts" class="size-3">evenement</a>
<a href="/tag/firefox" title="firefox: 4 posts" class="size-3">firefox</a>
<a href="/tag/flash" title="flash: 1 posts" class="size-0">flash</a>
<a href="/tag/gem" title="gem: 1 posts" class="size-0">gem</a>
<a href="/tag/generics" title="generics: 4 posts" class="size-3">generics</a>
<a href="/tag/git" title="git: 5 posts" class="size-4">git</a>
<a href="/tag/google" title="google: 2 posts" class="size-1">google</a>
<a href="/tag/grep" title="grep: 2 posts" class="size-1">grep</a>
<a href="/tag/GWT" title="GWT: 7 posts" class="size-5">GWT</a>
<a href="/tag/h2" title="h2: 2 posts" class="size-1">h2</a>
<a href="/tag/heroku" title="heroku: 1 posts" class="size-0">heroku</a>
<a href="/tag/Hibernate" title="Hibernate: 5 posts" class="size-4">Hibernate</a>
<a href="/tag/Hibernate4gwt" title="Hibernate4gwt: 2 posts" class="size-1">Hibernate4gwt</a>
<a href="/tag/java" title="java: 16 posts" class="size-12">java</a>
<a href="/tag/javascript" title="javascript: 1 posts" class="size-0">javascript</a>
<a href="/tag/jdk5" title="jdk5: 5 posts" class="size-4">jdk5</a>
<a href="/tag/jdk6" title="jdk6: 1 posts" class="size-0">jdk6</a>
<a href="/tag/jenkins" title="jenkins: 1 posts" class="size-0">jenkins</a>
<a href="/tag/JMS" title="JMS: 2 posts" class="size-1">JMS</a>
<a href="/tag/linux" title="linux: 1 posts" class="size-0">linux</a>
<a href="/tag/lucid-lynx" title="lucid-lynx: 1 posts" class="size-0">lucid-lynx</a>
<a href="/tag/maven" title="maven: 9 posts" class="size-7">maven</a>
<a href="/tag/nodejs" title="nodejs: 1 posts" class="size-0">nodejs</a>
<a href="/tag/oh-my-zsh" title="oh-my-zsh: 1 posts" class="size-0">oh-my-zsh</a>
<a href="/tag/opschef" title="opschef: 1 posts" class="size-0">opschef</a>
<a href="/tag/Oracle" title="Oracle: 9 posts" class="size-7">Oracle</a>
<a href="/tag/phantomjs" title="phantomjs: 1 posts" class="size-0">phantomjs</a>
<a href="/tag/ppa" title="ppa: 1 posts" class="size-0">ppa</a>
<a href="/tag/puppet" title="puppet: 1 posts" class="size-0">puppet</a>
<a href="/tag/ruby" title="ruby: 2 posts" class="size-1">ruby</a>
<a href="/tag/sed" title="sed: 1 posts" class="size-0">sed</a>
<a href="/tag/shell" title="shell: 6 posts" class="size-4">shell</a>
<a href="/tag/sonar" title="sonar: 1 posts" class="size-0">sonar</a>
<a href="/tag/spring" title="spring: 3 posts" class="size-2">spring</a>
<a href="/tag/springbatch" title="springbatch: 5 posts" class="size-4">springbatch</a>
<a href="/tag/springbatchinaction" title="springbatchinaction: 2 posts" class="size-1">springbatchinaction</a>
<a href="/tag/Stripes" title="Stripes: 2 posts" class="size-1">Stripes</a>
<a href="/tag/subversion" title="subversion: 1 posts" class="size-0">subversion</a>
<a href="/tag/sugfr" title="sugfr: 4 posts" class="size-3">sugfr</a>
<a href="/tag/svn" title="svn: 6 posts" class="size-4">svn</a>
<a href="/tag/svn2git" title="svn2git: 1 posts" class="size-0">svn2git</a>
<a href="/tag/testng" title="testng: 1 posts" class="size-0">testng</a>
<a href="/tag/tomcat" title="tomcat: 3 posts" class="size-2">tomcat</a>
<a href="/tag/twitter" title="twitter: 2 posts" class="size-1">twitter</a>
<a href="/tag/Ubuntu" title="Ubuntu: 38 posts" class="size-25">Ubuntu</a>
<a href="/tag/Uncategorized" title="Uncategorized: 4 posts" class="size-3">Uncategorized</a>
<a href="/tag/vagrant" title="vagrant: 1 posts" class="size-0">vagrant</a>
<a href="/tag/vi" title="vi: 2 posts" class="size-1">vi</a>
<a href="/tag/viewsvn" title="viewsvn: 1 posts" class="size-0">viewsvn</a>
<a href="/tag/vmware" title="vmware: 1 posts" class="size-0">vmware</a>
<a href="/tag/vows" title="vows: 1 posts" class="size-0">vows</a>
<a href="/tag/wordpress" title="wordpress: 1 posts" class="size-0">wordpress</a>
<a href="/tag/zsh" title="zsh: 1 posts" class="size-0">zsh</a>
              </div>
              <h4>Archives</h4>
              <div id="archives" class="tagcloud"><a href="/archive.html" title="Total: 81 posts" class="size-25">Toutes</a>
<a href="/archive/2007" title="2007: 46 posts" class="size-25">2007</a>
<a href="/archive/2008" title="2008: 14 posts" class="size-11">2008</a>
<a href="/archive/2009" title="2009: 6 posts" class="size-4">2009</a>
<a href="/archive/2010" title="2010: 9 posts" class="size-7">2010</a>
<a href="/archive/2011" title="2011: 2 posts" class="size-1">2011</a>
<a href="/archive/2012" title="2012: 4 posts" class="size-3">2012</a>
              </div>
              <h4>Blogroll</h4>
              <li><a href="http://www.dviel.com/" target="_blank" class="ext">Damien Viel’s blog</a><span class="ext"></span></li>
              <li><a href="http://blogpro.toutantic.net/" target="_blank" class="ext">Aurélien Pelletier</a><span class="ext"></span></li>
              <li><a href="http://blog.aheritier.net/" target="_blank" class="ext">Le blog d"Arnaud</a><span class="ext"></span></li>
              <li><a href="http://blog.toutantic.net/" target="_blank" class="ext">Aurel"s blog</a><span class="ext"></span></li>
              <li><a href="http://blog.loof.fr/" target="_blank" class="ext">new Blog( perso );</a><span class="ext"></span></li>
              <li><a href="http://www.application-servers.com/" target="_blank" class="ext">a19s</a><span class="ext"></span></li>
              <li><a href="http://www.onirik.org/" target="_blank" class="ext">Onirik</a><span class="ext"></span></li>
              <li><a href="http://grumeautique.blogspot.com/" target="_blank" class="ext">Petit précis de Grumeautique</a><span class="ext"></span></li>
              <h4>Feeds</h4><a target="_blank" style="cursor:pointer;" href="http://feeds.feedburner.com/bazoud/feed"><img alt="Feed" title="Feed" src="/images/rss.png"/></a><a target="_blank" style="cursor:pointer;" href="http://feeds.feedburner.com/bazoud/comments"><img alt="Comments Feed" title="Comments Feed" src="/images/rss.png"/></a>
            </ul>
          </div>
        </div>
        <div class="span8">
          <div class="content">
            <div class="row">
              <div class="span12">
                <div class="page-header"><a href="/articles/2010-05-31-groovy-aime-hudson/">
                    <h1>Groovy aime Hudson</h1></a></div>
                <p id="post_top_meta1" class="muted"><span class="meta-prep meta-prep-author">Posté le </span><span class="entry-date">lundi 31 mai 2010</span> | <span class="meta-sep"> Ecrit par </span><span class="author vcard">Olivier</span> | <a href="/articles/2010-05-31-groovy-aime-hudson/">Lien permanent</a> | <a href="#disqus_thread">Commentaires</a> | Posté dans <a href="/category/Uncategorized" rel="category tag" title="View all posts in 'Uncategorized'">Uncategorized</a>&nbsp;
                </p>
                <hr/>
                <div class="post_content"><p>A travers cet article, je vous propose quelques pistes pour administrer <a href="http://hudson-ci.org" target="_blank">Hudson</a> avec l&apos;aide <a href="http://groovy.codehaus.org" target="_blank">Groovy</a>. Personnellement, j&apos;utilise :
</p>
<p><ul>
    <li>des scripts avec <a href="http://wiki.hudson-ci.org/display/HUDSON/Remote+access+API" target="_blank">Hudson Remote API</a> et <a href="http://groovy.codehaus.org" target="_blank">Groovy</a></li>
    <li>la console <a href="http://groovy.codehaus.org" target="_blank">Groovy</a> de <a href="http://hudson-ci.org" target="_blank">Hudson</a></li>
</ul>
I. Hudson Remote API

</p>
<p>Une des problématiques de mon projet est le nombre de module ainsi que le nombre de version associés à maintenir. Le nombre de jobs à administrer dans Hudson se situe autour de 230. Il est évident que je ne peux pas les maintenir à la main, sans compter que le nombre de projet et de nombres versions augmentent régulièrement. J&apos;ai créé un petit outil qui permet de scanner le repository SVN et de créer les jobs Hudson associés, j&apos;ai choisi la <a href="http://wiki.hudson-ci.org/display/HUDSON/Remote+access+API" target="_blank">Hudson Remote API</a> et de coder en groovy.

</p>
<p>J&apos;ai créé 3 fichiers Groovy :
</p>
<p><ul>
    <li>Hudson.groovy qui assure la relation avec Hudson</li>
    <li>Subversion.groovy communique avec SVN à l&apos;aide <a href="http://svnkit.com" target="_blank">SVNKit</a></li>
    <li>svn2Hudson.groovy qui combine les deux : à partir d&apos;une url donnée, je vais récuperer les répertoires conformes à une pattern de nom et créer/mettre à jour les jobs Hudson</li>
</ul>
Pour illustrer par l&apos;exemple ces scripts, nous allons créer/mettre à jour les jobs Hudson pour le projet opensource <a href="http://www.hibernate.org/" target="_blank">Hibernate</a>. Les jobs concernent uniquement trunk et les branches commencant par le mot &quot;Branch&quot;.

</p>
<p>Il faut avoir installer un JDK, Hudson (avec le JDK et Maven configuré) et Groovy (configuré <a href="http://groovy.codehaus.org/GroovyWS+grape+config+file" target="_blank">configurer grape</a> pour le téléchargement SVNKit, ...).

</p>
<p>Ci-joint les sources :

</p>
<p>Hudson.groovy
</p>
<p><pre class="prettyprint">import org.xml.sax.SAXParseException
import groovy.xml.MarkupBuilder
import org.apache.commons.httpclient.HttpClient;
import org.apache.commons.httpclient.HttpMethod;
import org.apache.commons.httpclient.HttpMethodBase;
import org.apache.commons.httpclient.HttpStatus;
import org.apache.commons.httpclient.methods.GetMethod;
import org.apache.commons.httpclient.methods.PostMethod;
/<em>*
 </em> @author Olivier Bazoud
 */
@Grab(group = &apos;commons-httpclient&apos;, module = &apos;commons-httpclient&apos;, version = &apos;3.1&apos;)
class Hudson {
    def baseUrl, hudsonBaseUrl;
    def connectionManagerTimeout = 15000, connectionTimeout = 15000, soTimeout = 15000;

</p>
<pre><code><span class="comment">// Ping hudson</span>
def ping() {
    def client = <span class="keyword">new</span> HttpClient()
    def getMethod = <span class="keyword">new</span> GetMethod(baseUrl + hudsonBaseUrl)
    client.params.connectionManagerTimeout = connectionManagerTimeout
    client.httpConnectionManager.params.connectionTimeout = connectionTimeout
    client.params.soTimeout = soTimeout
    def status = client.executeMethod(getMethod)
    <span class="keyword">if</span> (status != HttpStatus.SC_OK) {
        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Ping failed : "</span> + status);
    }
}

<span class="comment">// add a job</span>
def put(String jobName, String config) {
    def client = <span class="keyword">new</span> HttpClient()
    def postMethod = <span class="keyword">new</span> PostMethod(baseUrl + hudsonBaseUrl + <span class="string">"createItem?name=$jobName"</span>);
    client.params.connectionManagerTimeout = connectionManagerTimeout
    client.httpConnectionManager.params.connectionTimeout = connectionTimeout
    client.params.soTimeout = soTimeout
    postMethod.setRequestHeader(<span class="string">"Content-type"</span>, <span class="string">"application/xml; charset=ISO-8859-1"</span>)
    postMethod.setRequestBody(config)
    def status = client.executeMethod(postMethod)
    <span class="keyword">if</span> (status != HttpStatus.SC_OK) {
        <span class="keyword">if</span> (status != HttpStatus.SC_BAD_REQUEST) {
            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Put $jobName failed : "</span> + status, <span class="keyword">new</span> RuntimeException(postMethod.getResponseBodyAsString()))
        }
    } <span class="keyword">else</span> {
        println <span class="string">"Put $jobName created."</span>
    }
}

<span class="comment">// update a job</span>
def update(String jobName, String config) {
    def client = <span class="keyword">new</span> HttpClient()
    def postMethod = <span class="keyword">new</span> PostMethod(baseUrl + hudsonBaseUrl + <span class="string">"/job/$jobName/config.xml"</span>);
    client.params.connectionManagerTimeout = connectionManagerTimeout
    client.httpConnectionManager.params.connectionTimeout = connectionTimeout
    client.params.soTimeout = soTimeout
    postMethod.setRequestHeader(<span class="string">"Content-type"</span>, <span class="string">"application/xml; charset=ISO-8859-1"</span>)
    postMethod.setRequestBody(config)
    def status = client.executeMethod(postMethod)
    <span class="keyword">if</span> (status != HttpStatus.SC_OK) {
        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Updating $jobName failed : "</span> + status, <span class="keyword">new</span> RuntimeException(postMethod.getResponseBodyAsString()))
    } <span class="keyword">else</span> {
        println <span class="string">"$jobName updated."</span>
    }
}

<span class="comment">// get job</span>
def fetch(String jobName, boolean failIfNotExist) {
    def client = <span class="keyword">new</span> HttpClient()
    def getMethod = <span class="keyword">new</span> GetMethod(baseUrl + hudsonBaseUrl + <span class="string">"job/$jobName/config.xml"</span>)

    client.params.connectionManagerTimeout = connectionManagerTimeout
    client.httpConnectionManager.params.connectionTimeout = connectionTimeout
    client.params.soTimeout = soTimeout

    def status = client.executeMethod(getMethod)
    <span class="keyword">if</span> (status != HttpStatus.SC_OK) {
        <span class="keyword">if</span> (failIfNotExist) {
            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Get xml $jobName failed : "</span> + status)
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="keyword">null</span>;
        }

    }

    def root = <span class="keyword">new</span> XmlParser().parseText(getMethod.getResponseBodyAsString())
}

<span class="comment">// saveOrUpdate a job</span>
def saveOrUpdate(String jobName, String config) {
    <span class="keyword">if</span> (fetch(jobName, <span class="keyword">false</span>) != <span class="keyword">null</span>) {
        update(jobName, config)
    } <span class="keyword">else</span> {
        put(jobName, config)
    }
}

def createMaven2Config(String svnUrl) {
    def writer = <span class="keyword">new</span> StringWriter()
    def xml = <span class="keyword">new</span> MarkupBuilder(writer)
    xml.<span class="string">'maven2-moduleset'</span>() {
        scm(<span class="keyword">class</span> : <span class="string">'hudson.scm.SubversionSCM'</span>) {
            locations() {
                <span class="string">'hudson.scm.SubversionSCM_-ModuleLocation'</span>() {
                    remote(<span class="string">"$svnUrl"</span>)
                    local(<span class="string">'wk'</span>)
                 }
            }
            useUpdate(<span class="string">'true'</span>)
        }
        disabled(<span class="string">'false'</span>)
        jdk(<span class="string">'jdk1.6'</span>)
        goals(<span class="string">'clean package'</span>)
        mavenName(<span class="string">'maven-2.x'</span>)
        aggregatorStyleBuild(<span class="string">'true'</span>)
    }
    <span class="keyword">return</span> writer.toString()
}</code></pre>
<p>}</pre>
Subversion.groovy
</p>
<p><pre class="prettyprint">import org.tmatesoft.svn.core.internal.io.fs.FSRepositoryFactory
import org.tmatesoft.svn.core.internal.io.dav.DAVRepositoryFactory
import org.tmatesoft.svn.core.internal.io.svn.SVNRepositoryFactoryImpl
import org.tmatesoft.svn.core.SVNURL
import org.tmatesoft.svn.core.io.SVNRepository
import org.tmatesoft.svn.core.io.SVNRepositoryFactory
import org.tmatesoft.svn.core.wc.SVNWCUtil
import static org.tmatesoft.svn.core.SVNNodeKind.DIR
/<em>*
 </em> @author Olivier Bazoud
 */
@Grab(group = &apos;org.tmatesoft.svnkit&apos;, module = &apos;svnkit&apos;, version = &apos;1.3.3&apos;)
class Subversion {
    def url;
    def name;
    def password;
    def repository;

</p>
<pre><code>def connect() {
    println <span class="string">"Connecting to $url ..."</span>
    setup();
    repository = SVNRepositoryFactory.create(SVNURL.parseURIDecoded(url));
    def authManager = SVNWCUtil.createDefaultAuthenticationManager(<span class="keyword">null</span>, name, password, <span class="keyword">false</span>);
    repository.setAuthenticationManager(authManager);
    println <span class="string">'Connection OK.'</span>
} 

def disconnect() {
    repository.closeSession()
}

def setup() {
    DAVRepositoryFactory.setup();
    SVNRepositoryFactoryImpl.setup();
    FSRepositoryFactory.setup();
}

def fetch(def path, def includes) {
    def map = [:]
    repository.getDir(path, -<span class="number">1</span>, <span class="keyword">null</span>, (Collection) <span class="keyword">null</span>).each { entry -&amp;gt;
        <span class="keyword">if</span> (entry.getKind() == DIR) {
            <span class="keyword">if</span> (includes.matcher(entry.getName()).matches()) {
                map.put(entry.name.toLowerCase(), entry.getURL().toString())
            }
        }
    }
    <span class="keyword">return</span> map
}</code></pre>
<p>}</pre>
svn2Hudson.groovy
</p>
<p><pre class="prettyprint">#!/usr/bin/env groovy
// @author Olivier BAZOUD
def baseUrl = &apos;<a href="http://localhost:8080">http://localhost:8080</a>&apos;
def hudsonBaseUrl = &apos;/&apos;
def svnBaseUrl = &apos;<a href="http://anonsvn.jboss.org/repos/hibernate">http://anonsvn.jboss.org/repos/hibernate</a>&apos;
def hudson = new Hudson(baseUrl : &quot;$baseUrl&quot;, hudsonBaseUrl : &quot;$hudsonBaseUrl&quot;)
def subversion = new Subversion(url : svnBaseUrl, name : &apos;anonymous&apos;, password : &apos;anonymous&apos;)
def map = [:]
// Subversion
try {
    subversion.connect()
    println &quot;Fetching ...&quot;
    map &lt;&lt; subversion.fetch(&quot;core&quot;, ~/trunk/)
    map &lt;&lt; subversion.fetch(&quot;core/branches&quot;, ~/Branch.*/)
} finally {
    subversion.disconnect()
}
// Hudson
hudson.ping()
map.each {
    hudson.saveOrUpdate(&quot;hibernate-&quot; + it.key, hudson.createMaven2Config(it.value))
}</pre>
Maintenant, on peut lancer le scripts qui va mettre à jour les jobs Hudson :
</p>
<p><pre class="prettyprint lang-bsh">./svn2Hudson.groovy
Connecting to <a href="http://anonsvn.jboss.org/repos/hibernate">http://anonsvn.jboss.org/repos/hibernate</a> ...
Connection OK.
Fetching ...
Put hibernate-trunk created.
Put hibernate-branch_3_1 created.
Put hibernate-branch_3_2 created.
Put hibernate-branch_3_3 created.
Put hibernate-branch_3_2_4_sp1_cp created.
Put hibernate-branch_3_5 created.
Put hibernate-branch_3_3_2_ga_cp created.</pre>
Liste des jobs Hudson :
<a href="/images/hudson-groovy.png"><img class="aligncenter size-medium wp-image-401" title="hudson-groovy" src="/images/hudson-groovy-300x235.png" alt="Création des jobs Hudson avec Groovy" width="300" height="235" /></a>

</p>
<p>A noter que si l&apos;on relance le scripts, les jobs sont mis à jour ;
</p>
<p><pre class="prettyprint lang-bsh">Connecting to <a href="http://anonsvn.jboss.org/repos/hibernate">http://anonsvn.jboss.org/repos/hibernate</a> ...
Connection OK.
Fetching ...
hibernate-trunk updated.
hibernate-branch_3_1 updated.
hibernate-branch_3_2 updated.
hibernate-branch_3_3 updated.
hibernate-branch_3_2_4_sp1_cp updated.
hibernate-branch_3_5 updated.
hibernate-branch_3_3_2_ga_cp updated.</pre>
Dans cet artcle, j&apos;ai volontairement simplifier le script que j&apos;utilise pour un exemple simple d&apos;utilisation et de compréhension.
Par exemple, la génération de la configuration Hudson s&apos;adpate suivant la nature du projet :
</p>
<p><ul>
    <li>le goal maven clean package ou clean deploy</li>
    <li>le MAVEN_OPTS avec plus ou moins de mémoire et différentes options</li>
    <li>configuration de nombreux plugins : JIRA, <a href="http://www.sonarsource.org/" target="_blank">sonar</a>, Mail, IRC, ...</li>
    <li>il existe plusieurs options en arguments : create only ou update only</li>
    <li>de nombreuse fonctionnalités sont présentes : lancer un job, le détruire, lister tous les jobs, job avec une configuration ant, ...</li>
</ul>
De même que le parcours SVN n&apos;est pas aussi simpliste, j&apos;utilise plusieurs modules, les externals SVN.

</p>
<p>Cerise que le gateau, le script svn2Hudson est dans un job Hudson qui se lance tous les matins, les jobs Hudson s&apos;administrent tout seul.
Depuis Avril 2009, date à laquelle j&apos;ai créé ce script, je n&apos;ai plus à jamais à créer de jobs Hudson.
De plus, lors des updates de version de Hudson (toutes les semaines) et les ajouts/updates de plugins, je n&apos;ai qu&apos;à adapter ces scripts, cela se fait rapidemment et tous les jobs sont opérationnelles avec la nouvelle configuration.

</p>
<p>II. La console Groovy de Hudson

</p>
<p>La console Groovy permet d&apos;interagir &quot;en live&quot; avec votre instance web Hudson. Je l&apos;utilise pour l&apos;administration quotidienne à l&apos;aide de script assez simple. Cette console se situe ici : <a href="http://hudsoninstance/script">http://hudsoninstance/script</a>

</p>
<p>Quelques exemples sont disponibles : <a href="http://wiki.hudson-ci.org/display/HUDSON/Hudson+Script+Console" target="_blank"><a href="http://wiki.hudson-ci.org/display/HUDSON/Hudson+Script+Console&lt;/a&gt;">http://wiki.hudson-ci.org/display/HUDSON/Hudson+Script+Console&lt;/a&gt;</a>

</p>
<p>Pour illustrer les scripts suivants, je vais utiliser l&apos;instance Hudson sur laquelle je viens de créer les jobs Hibernate.
</p>
<p><pre class="prettyprint">// Compter certains les jobs
hudsonInstance = hudson.model.Hudson.instance
allItems = hudsonInstance.items
jobs = allItems.findAll{job -&gt; job.isBuildable() &amp;&amp; job.name =~ &quot;hibernate-.*&quot;}
println jobs.size()</pre>
<a href="/images/hudson-groovy-2.png"><img class="aligncenter size-full wp-image-417" title="hudson-groovy-2" src="/images/hudson-groovy-2.png" alt="" width="534" height="316" /></a>
</p>
<p><pre class="prettyprint">// Relancer tous les jobs
hudsonInstance = hudson.model.Hudson.instance
allItems = hudsonInstance.items
jobs = allItems.findAll{job -&gt; job.isBuildable()}
cause = new hudson.model.Cause.RemoteCause(&quot;localhost&quot;, &quot;bulk build&quot;)
jobs.each{ run -&gt; run.scheduleBuild(cause)}</pre>
</p>
<p><pre class="prettyprint">// Relancer les jobs failed
hudsonInstance = hudson.model.Hudson.instance
allItems = hudsonInstance.items
jobs = allItems.findAll{job -&gt; job.isBuildable() &amp;&amp; job.lastBuild != null &amp;&amp; job.lastBuild.result == hudson.model.Result.FAILURE}
cause = new hudson.model.Cause.RemoteCause(&quot;localhost&quot;, &quot;bulk build&quot;)
jobs.each{ run -&gt; run.scheduleBuild(cause)}</pre>
</p>
<p><pre class="prettyprint">// Detruire tous certains jobs
hudsonInstance = hudson.model.Hudson.instance
allItems = hudsonInstance.items
jobs = allItems.findAll{job -&gt; job.isBuildable() &amp;&amp; job.name =~ &quot;hibernate-.*&quot;}
jobs.each{ run -&gt; run.delete()}</pre>
<a href="/images/hudson-groovy3.png"><img class="aligncenter size-large wp-image-421" title="hudson-groovy3" src="/images/hudson-groovy3-1024x232.png" alt="" width="1024" height="232" /></a>

</p>
<p>Pour un exemple un peu plus compliqué, je vous renvoie vers <a href="http://blog.aheritier.net/convertir-en-masse-les-notifications-standard-hudson-par-celles-du-plugin-email-ext" target="_blank">Le blog d’Arnaud</a> qui a converti en masse les notifications standard Hudson par celles du plugin Email-Ext.

</p>
<p>III. Conclusion

</p>
<p>Avec l&apos;API Remote Access et avec la console Groovy de Hudson, vous pouvez aisément administrer votre instance Hudson.
Si vous faites ou avez de tels scripts, tenez moi au courant.</p>

                </div>
                <hr/>
                <p id="post_top_meta1" class="muted"><span class="meta-prep meta-prep-author">Posté le </span><span class="entry-date">lundi 31 mai 2010</span> | <span class="meta-sep"> Ecrit par </span><span class="author vcard">Olivier</span> | <a href="/articles/2010-05-31-groovy-aime-hudson/">Lien permanent</a> | <a href="#disqus_thread">Commentaires</a> | Posté dans <a href="/category/Uncategorized" rel="category tag" title="View all posts in 'Uncategorized'">Uncategorized</a>&nbsp;
                </p>
                <p id="post_bottom_meta2" class="muted">Taggé avec: 
                </p>
                <div id="social_bottom" class="topsocial">
                  <div class="social"><a href="/post/2010-05-31-groovy-aime-hudson.html" data-url="http://blog.bazoud.com/post/2010-05-31-groovy-aime-hudson.html" data-text="Groovy aime Hudson  /via @obazoud" data-count="vertical" class="twitter-share-button">
                      <twitter-share-button></twitter-share-button></a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
                  </div>
                  <div class="social"><g:plusone size="tall" href="http://blog.bazoud.com/post/2010-05-31-groovy-aime-hudson.html"></g:plusone></div>
                  <div class="social">
                    <script src="http://platform.linkedin.com/in.js" type="text/javascript"></script>
                    <script type="IN/Share" data-url="http://blog.bazoud.com/post/2010-05-31-groovy-aime-hudson.html" data-counter="top"></script>
                  </div>
                  <div class="social">
                    <div class="share-delicious">
                      <div id="delic" class="delicious">0</div>
                      <div id="delicious-b"><a href="http://del.icio.us/post?url=http://blog.bazoud.com/post/2010-05-31-groovy-aime-hudson.html&amp;title=&quot;Save To Delicious&quot;" target="blank">delicious</a></div>
                    </div> <script type='text/javascript'>
                     function delic(info) {
                      if(!info[0]) return;
                      var num = info[0].total_posts;
                       if(!num) return;
                       var delic = document.getElementById('delic');
                       delic.innerHTML = '' + num;
                       delic.style.textIndent = 0;
                       delic.style.paddingRight= '6px';
                     }
                     </script>
                     <script src='http://badges.del.icio.us/feeds/json/url/data?url=http://blog.bazoud.com/post/2010-05-31-groovy-aime-hudson.html'&callback=declic></script>
                  </div>
                </div><script type="text/javascript">
                  (function() {
                    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                    po.src = 'https://apis.google.com/js/plusone.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                  })();
                </script>
                <hr/>
                <h3>Articles similaires</h3>
                <table class="table table-striped">
                  <tbody>
                  </tbody>
                </table>
                <h3>Commentaires</h3>
                <div id="disqus_thread"></div><script type="text/javascript">
                var disqus_shortname = 'bazoud';
                (function() {
                   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                   dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="inner">
        <p class="pull-right"><a href="#">Revenir en haut</a></p>
        <p>
           
          Le blog d'Olivier - Copyright © 2007-2012  Olivier Bazoud - Powered by <a href="http://www.nodejs.org" title="Powered by Node.js" target="_blank">Node.js</a> and<a href="https://github.com/jnordberg/wintersmith" title="Powered by Wintersmith" target="_blank"> Wintersmith </a> - Special thanks to <a href="http://twitter.github.com/bootstrap/" target="_blank" title="Bootstrap, from Twitter">Twitter Bootstrap</a>
        </p>
      </div>
    </footer><script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1176603-1']);
     
    _gaq.push(['_trackPageview']);
     
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>